# TTL 설정 전략
**ID:** 202509216_TTL설정전략
**생성일:** 2025-09-21
**태그:** #캐시 #TTL #데이터일관성

## 핵심 개념

TTL(Time-To-Live)은 캐시된 데이터의 유효 기간을 설정하는 메커니즘이다. 적절한 TTL 설정은 데이터 일관성과 성능 사이의 균형을 맞추는 핵심 요소다.

## TTL 설정 기준

### 1. 데이터 변경 빈도 기반

**자주 변경되는 데이터 (짧은 TTL)**
- 실시간 재고 정보: 5-10분
- 사용자 활동 상태: 30초-1분
- 주식 가격, 환율: 몇 초-1분

**거의 변경되지 않는 데이터 (긴 TTL)**
- 상품 카테고리: 1-24시간
- 사용자 기본 정보: 30분-1시간
- 시스템 설정: 몇 시간-1일

### 2. 비즈니스 요구사항 기반

**일관성이 중요한 데이터**
- 결제 정보: 매우 짧은 TTL 또는 즉시 무효화
- 재고 수량: 짧은 TTL과 이벤트 기반 무효화 병행

**성능이 중요한 데이터**
- 정적 컨텐츠: 매우 긴 TTL
- 추천 알고리즘 결과: 중간 길이 TTL

## 고급 TTL 전략

### 1. 동적 TTL 조정

```python
def calculate_ttl(data_type, access_frequency):
    base_ttl = get_base_ttl(data_type)
    if access_frequency > threshold:
        return base_ttl * 2  # 자주 접근되면 더 오래 유지
    return base_ttl
```

### 2. 확률적 조기 만료

```python
import random

def should_refresh_early(ttl_remaining, total_ttl):
    # TTL의 10% 남았을 때부터 확률적으로 갱신
    threshold = total_ttl * 0.1
    if ttl_remaining <= threshold:
        return random.random() < 0.3  # 30% 확률로 조기 갱신
    return False
```

## 실제 적용 예시

### 계층별 TTL 설정
```
# L1 캐시 (애플리케이션 로컬)
user_session: 5분

# L2 캐시 (Redis)
user_profile: 30분
product_details: 1시간

# CDN 캐시
static_images: 24시간
CSS/JS 파일: 1주일
```

## 모니터링 지표

- **캐시 히트율**: TTL이 너무 짧으면 히트율 하락
- **데이터 일관성**: TTL이 너무 길면 stale 데이터 증가
- **메모리 사용량**: TTL 설정에 따른 메모리 점유율 변화

## 관련 개념

- [[202509213_Look-Aside캐시패턴]] - TTL이 적용되는 기본 캐시 패턴
- [[202509215_캐시스탬피드현상]] - TTL 만료 시 발생할 수 있는 문제
- [[202509219_캐시워밍전략]] - TTL 만료 전 미리 캐시를 갱신하는 방법

## 결론

TTL 설정은 데이터의 특성, 비즈니스 요구사항, 시스템 성능을 종합적으로 고려하여 결정해야 하며, 지속적인 모니터링과 조정이 필요한 동적인 과정이다.