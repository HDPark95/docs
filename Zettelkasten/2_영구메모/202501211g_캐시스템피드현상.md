---
영구메모_ID: 202501211g
생성일: 2025-01-21
수정일: 2025-01-21
제목: 캐시 스템피드 현상 (Cache Stampede)
태그: #캐시스템피드 #성능문제 #동시성
연결: [[202501211a_Look-Aside패턴]] [[202501211c_TTL개념]] [[202501211j_캐시워밍]]
부모: [[202501211_캐시기본개념]]
---

# 캐시 스템피드 현상 (Cache Stampede)

캐시 스템피드는 캐시가 만료되거나 비어있을 때 다수의 요청이 동시에 원본 데이터 소스에 접근하여 급작스러운 부하를 발생시키는 현상이다.

## 발생 상황

- **캐시 만료 시점**: TTL 만료로 캐시가 삭제된 직후
- **캐시 미스**: 인기 있는 데이터가 캐시에 없을 때
- **시스템 재시작**: 콜드 스타트 상황에서 빈 캐시
- **캐시 무효화**: 수동으로 캐시를 클리어한 후

## 문제점

- **DB 부하 급증**: 동시에 몰리는 요청으로 데이터베이스 과부하
- **응답 시간 증가**: DB 부하로 인한 전체적인 성능 저하
- **시스템 장애**: 심한 경우 DB 다운이나 타임아웃 발생

## 해결 방안

### 1. 세마포어 잠금 메커니즘
```
if (캐시에 데이터 없음) {
    if (잠금 획득 성공) {
        // 첫 번째 요청만 DB 조회
        데이터 = DB에서 조회()
        캐시에 저장(데이터)
        잠금 해제()
        return 데이터
    } else {
        // 나머지 요청은 대기 후 캐시에서 조회
        잠금 대기()
        return 캐시에서 조회()
    }
}
```

### 2. 확률적 조기 만료 (Probabilistic Early Expiration)
- TTL 만료 전에 확률적으로 캐시를 갱신
- 만료 시점을 분산시켜 동시 접근 방지

### 3. 백그라운드 갱신 (Background Refresh)
- 별도의 백그라운드 프로세스에서 주기적으로 캐시 갱신
- 캐시가 만료되기 전에 미리 새로운 데이터로 교체

## 모니터링 지표

- **동시 DB 접근 수**: 특정 시점의 동시 쿼리 수
- **캐시 미스율**: 평소보다 급격히 증가하는 패턴
- **응답 시간 스파이크**: 특정 시점의 응답 시간 급증