5장 웹서버

웹서버란 무엇인가

• 웹서버는 HTTP 요청을 처리하고 응답을 제공하는 소프트웨어다.

• 웹서버 소프트웨어와 웹서버용 장비 모두를 가리킨다.

⸻

웹서버 구현

• 간단한 Perl 스크립트나 범용 소프트웨어까지 다양하게 구현 가능하다.

• 웹서버는 HTTP 프로토콜을 구현하고, 웹 리소스를 관리하며, 웹서버 관리 기능을 제공한다.

⸻

다양한 형태의 웹서버

• 범용 소프트웨어 웹서버: 표준 컴퓨터 시스템에서 동작하는 웹서버 소프트웨어

• 임베디드 웹서버: 일반 소비자용 제품에 내장되어 사용자가 자신의 제품을 관리할 수 있게 해주는 작은 웹서버

⸻

진짜 웹서버가 하는 일
1. 커넥션 수락

   • 클라이언트의 접속을 받아들이거나, 원치 않는 클라이언트라면 닫는다.

2. 요청 받기

   • HTTP 요청 메시지를 네트워크로부터 읽어 들인다.

3. 요청 처리

   • 요청 메시지를 해석하고 행동을 취한다.

4. 리소스에 접근

   • 메시지에서 지정한 리소스에 접근한다.

5. 응답 만들기

   • 올바른 헤더를 포함해 HTTP 응답 메시지를 생성한다.

6. 응답 보내기

   • 응답을 클라이언트에게 돌려준다.

7. 트랜잭션을 로그로 남기기

   • 완료된 트랜잭션에 대한 로그를 파일에 기록한다.

⸻

커넥션 수락

• 새 커넥션에서는 클라이언트를 식별하거나 클라이언트가 누구인지 파악하기 위해 IP 주소를 역방향 DNS로 변환해 클라이언트의 호스트명을 알아낸다.

• 대부분의 웹서버는 역방향 DNS를 비활성화해 웹 트랜잭션을 빠르게 수행한다.

• ident 프로토콜로 클라이언트 사용자명을 알아낼 수도 있다.

⸻

요청 메시지 수신

• 커넥션에 데이터가 도착하면, 웹서버는 네트워크 커넥션에서 그 데이터를 읽어 들이고 요청 메시지를 파싱한다.

• 메시지를 여러 부분으로 파싱: 요청줄을 파싱해 요청 메서드, 지정된 리소스의 식별자(URI), 버전 번호를 찾는다.

• 메시지 헤더들을 읽어 들인다. 각 메시지 헤더는 CRLF로 끝난다.

• 헤더의 끝을 의미하는 CRLF로 끝나는 빈 줄을 찾아낸다.

• 요청 본문이 있다면 읽어 들인다.

⸻

메시지의 내부 표현

• 몇몇 웹서버는 요청 메시지를 쉽게 다룰 수 있도록 내부의 자료 구조에 저장한다.

⸻

커넥션 입력/출력 처리 아키텍처

• 단일 스레드 웹서버: 한 번에 하나씩 요청을 처리한다. 트랜잭션이 완료되면 다음 커넥션이 처리된다.

• 멀티프로세스와 멀티스레드 웹서버: 여러 요청을 동시에 처리한다.

• 다중화 I/O 서버: 모든 커넥션은 동시에 그 활동을 감시당한다.

• 다중 아키텍처 웹서버: 여러 아키텍처를 결합한다.

⸻

리소스의 매핑과 접근

• docroot: 웹서버 파일 시스템의 특별한 폴더. 웹 콘텐츠를 위해 예약되어 있다.

• 가상 호스팅된 docroot: 가상 호스팅 웹서버에서는 각 사이트마다 분리된 문서 루트를 갖는다.

• 사용자 홈 디렉터리 docroot: 사용자들이 한 대의 웹서버에서 개인 웹사이트를 만들 수 있게 해준다.

⸻

디렉터리 목록

• 웹서버는 경로가 파일이 아닌 디렉터리를 가리키는 디렉터리 URL에 대한 요청을 받을 수 있다.

• 대부분의 웹서버는 다음과 같은 행동을 하도록 설정할 수 있다:
  - 에러를 반환한다.
  - 디렉터리 대신 특별한 '색인 파일'을 반환한다.
  - 디렉터리를 탐색해서 그 내용을 담은 HTML 페이지를 반환한다.

⸻

동적 콘텐츠 리소스 매핑

• 웹서버는 URI를 동적 리소스에 매핑할 수도 있다. 즉, 요청에 맞게 콘텐츠를 생성하는 프로그램에 URI를 매핑하는 것이다.

⸻

서버사이드 인클루드(SSI)

• 어떤 리소스가 서버사이드 인클루드를 포함하고 있는 것으로 설정되어 있다면, 서버는 그 리소스의 콘텐츠를 클라이언트에게 보내기 전에 처리한다.

⸻

접근 제어

• 웹서버는 각각의 리소스에 접근 제어를 할당할 수 있다. 접근 제어되는 리소스에 대한 요청이 도착했을 때 웹서버는 클라이언트의 IP 주소에 근거하여 접근을 제어하거나 리소스에 접근하기 위한 비밀번호를 물어볼 수 있다.

⸻

응답 만들기

• 응답 엔터티: 응답 본문의 MIME 타입을 서술하는 Content-Type 헤더와 응답 본문의 길이를 서술하는 Content-Length 헤더를 포함해야 한다.

• MIME 타입 결정: 웹서버에게는 응답 본문의 MIME 타입을 결정하는 여러 방법이 있다.

• 리다이렉션: 웹서버는 때때로 요청을 수행하는 대신 브라우저가 다른 곳으로 가서 요청을 다시 수행하도록 리다이렉트한다.

⸻

응답 보내기

• 웹서버는 받을 때와 마찬가지로 커넥션 상태를 추적해야 하고 지속적인 커넥션을 다룰 때는 특별한 주의를 기울여야 한다.

⸻

로깅

• 웹서버는 HTTP 트랜잭션이 완료되었을 때 트랜잭션이 어떻게 수행되었는지에 대한 로그를 로그파일에 기록한다.

⸻