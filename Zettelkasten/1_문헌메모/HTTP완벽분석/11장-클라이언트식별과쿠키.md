# 11장 - 클라이언트 식별과 쿠키

## 11.1 개별 접촉
HTTP는 익명으로 사용하며, 상태가 없고(stateless) 요청과 응답으로 통신하는 프로토콜이다. 서버가 클라이언트를 식별하고 추적하는 것은 웹 애플리케이션의 필수 기능이다.

### 핵심 개념
- HTTP의 무상태성으로 인한 클라이언트 식별 필요성
- 개인화된 서비스 제공을 위한 사용자 추적
- 트랜잭션 간 상태 유지 메커니즘

### 실무 적용 포인트
- 사용자별 맞춤 콘텐츠 제공
- 세션 관리 및 인증 상태 유지
- 장바구니, 사용자 설정 등 상태 정보 관리


## 11.2 HTTP 헤더

### 11.2.1 From 헤더
- 사용자의 이메일 주소 포함
- 스팸봇이 수집할 위험으로 거의 사용하지 않음
- 로봇이나 스파이더 프로그램에서 주로 사용

### 11.2.2 User-Agent 헤더
- 브라우저 이름과 버전 정보
- 운영체제 정보 포함
- 클라이언트 능력과 선호 파악에 활용

### 11.2.3 Referer 헤더
- 현재 페이지로 유입된 이전 페이지 URL
- 마케팅 분석과 추적에 활용
- 사용자 관심사 파악 가능

## 11.3 클라이언트 IP 주소

### 11.3.1 IP 주소의 한계
- 동일 컴퓨터의 여러 사용자 구분 불가
- ISP의 동적 IP 할당으로 변경 가능
- 모바일 사용자의 IP 주소 빈번한 변경

### 11.3.2 프록시와 NAT
- 클라이언트의 실제 IP 주소 숨김
- 여러 사용자가 동일한 외부 IP 공유
- 프록시 체인으로 인한 추적 어려움

## 11.4 사용자 로그인

### 11.4.1 기본 인증
- WWW-Authenticate와 Authorization 헤더 사용
- 401 상태 코드로 인증 요구
- Base64 인코딩 (암호화 아님)

### 11.4.2 다이제스트 인증
- 패스워드를 해시로 전송
- 재전송 공격 방지 위한 nonce 사용
- 기본 인증보다 보안성 높음

## 11.5 뚱뚱한 URL

### 11.5.1 개념과 동작 방식
- URL에 세션 ID나 상태 정보 포함
- 서버가 동적으로 URL 생성
- 모든 링크를 수정해야 함

### 11.5.2 장단점
- 장점: 쿠키 지원 없이도 동작
- 단점: URL 공유 시 개인정보 노출
- 단점: 못생기고 복잡한 URL, 캐시 사용 불가

## 11.6 쿠키

### 11.6.1 쿠키의 타입

#### 세션 쿠키
- 브라우저 메모리에만 저장
- 브라우저 종료 시 자동 삭제
- Expires나 Max-Age 속성 없음

#### 지속 쿠키
- 디스크에 파일로 저장
- 브라우저 재시작 후에도 유지
- Expires 또는 Max-Age로 수명 지정

### 11.6.2 쿠키는 어떻게 동작하는가
- 서버가 Set-Cookie 헤더로 쿠키 생성
- 클라이언트가 Cookie 헤더로 쿠키 전송
- 도메인과 경로가 일치할 때만 전송

### 11.6.3 쿠키 상자: 클라이언트 측 상태
- 브라우저별 쿠키 저장소 관리
- 쿠키 개수와 크기 제한 (4KB)
- 도메인당 쿠키 개수 제한 (보통 50개)

### 11.6.4 사이트마다 다른 쿠키
- Domain 속성으로 쿠키 범위 제한
- Path 속성으로 경로별 쿠키 구분
- 서버는 자신의 도메인 쿠키만 설정 가능

### 11.6.5 쿠키 구성요소

#### Domain 속성
- 쿠키를 전송할 도메인 지정
- 서브도메인 포함 가능 (.example.com)
- 명시하지 않으면 현재 도메인만 적용

#### Path 속성
- 쿠키를 전송할 URL 경로 지정
- 하위 경로에도 자동 적용
- 기본값은 현재 경로

### 11.6.6 쿠키와 세션 추적
- 세션 ID를 쿠키로 전송하여 상태 유지
- 서버 측에 실제 데이터 저장
- 세션 하이재킹 방지 위한 HTTPS 필수

### 11.6.7 쿠키와 캐싱

#### 캐싱 고려사항
- Set-Cookie 헤더 있는 응답 캐싱 주의
- 캐시된 쿠키로 인한 개인정보 노출 위험
- 동적 콘텐츠는 캐싱 비활성화 권장

#### Cache-Control 지시자
- no-cache="Set-Cookie" 사용
- private 지시자로 개인 캐시만 허용
- must-revalidate로 재검증 강제

### 11.6.8 쿠키, 보안 그리고 개인정보

#### 보안 이슈
- Secure 플래그: HTTPS 전송만 허용
- HttpOnly 플래그: JavaScript 접근 차단
- SameSite 속성: CSRF 공격 방지

#### 개인정보 이슈
- 제3자 쿠키를 통한 추적
- 민감 정보 평문 저장 금지
- GDPR 등 개인정보 규정 준수 필요

## 11.7 실무 적용 사례

### 세션 관리 구현
- 세션 ID 생성 시 충분한 엔트로피 확보
- 세션 타임아웃 설정 (보통 30분)
- 중요 작업 시 세션 ID 재생성

### 보안 고려사항
- HTTPS 환경에서만 쿠키 전송 (Secure)
- XSS 방지 위한 HttpOnly 설정
- CSRF 방지 위한 SameSite 설정

### 성능 최적화
- 쿠키 크기 최소화 (네트워크 오버헤드 감소)
- 필요한 경로에만 쿠키 전송
- 불필요한 쿠키 정리

## 11.8 핵심 정리

### 주요 개념
- HTTP 무상태성과 클라이언트 식별의 필요성
- 쿠키를 통한 상태 관리 메커니즘
- 보안과 프라이버시 균형

### 실무 체크리스트
- 적절한 쿠키 속성 설정 (Secure, HttpOnly, SameSite)
- 세션 보안 강화 (HTTPS, 타임아웃, ID 재생성)
- 개인정보 규정 준수 (쿠키 동의, 데이터 최소화)

### 관련 영구메모 연결
- [[]]
- [[]]
- [[]]

## 참고 자료
- HTTP 완벽 분석 11장
-
-